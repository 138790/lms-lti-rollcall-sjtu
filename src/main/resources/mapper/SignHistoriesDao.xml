<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lmsltirollcallsjtu.common.dao.SignHistoriesDao">


	<resultMap id="signHistoryInfo" type="com.lmsltirollcallsjtu.common.bean.bo.SignHistoryInfo">
		<id column="id" property="id"/>
		<result column="section_list" property="sectionListJsonStr"/>
		<result column="created_date" property="createdDate"/>
		<collection property="userState" ofType="com.lmsltirollcallsjtu.common.bean.bo.UserState">
			<id column="id" property="id"/>
			<result column="state" property="state"/>
			<result column="user_name" property="userName"/>
		</collection>
	</resultMap>

    <!--根据点名id查询某一次点名签到详情-->

    <select id="findSignHistoryByRollcallId" resultMap="signHistoryInfo">
		select
			  h.section_list,
	          h.created_date,
	          r.state,
	          r.user_name,
	          r.user_code
		from  sign_histories h
		inner join sign_records r on h.id=r.rollcall_code
		where  h.id=#{id}
	</select>
	<!--老师查询签到历史列表-->
	<!--<resultMap id="findSignHistory" type="com.lmsltirollcallsjtu.common.bean.bo.SignHistoryInfo">
		<result property="sectionIds" column="section_ids"/>
		<result property="attendancesCount" column="attendances_count"/>
		<result property="insertedAt" column="inserted_at"/>
		<collection property=""
	</resultMap>-->
	<select id="findSignHistoryListByCourseCode"
			parameterType="com.lmsltirollcallsjtu.common.bean.param.QuerySignHistoryListParam"
			resultType="com.lmsltirollcallsjtu.common.bean.dto.SignHistoryDto">
		select
		       section_list sectionListJsonStr,
			   attendances_count,
			   created_date
		  from
		  	   sign_histories
		 where
		 	   course_code=#{courseCode}
	</select>

</mapper>
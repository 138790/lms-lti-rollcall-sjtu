<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lmsltirollcallsjtu.common.dao.SignHistoriesDao">


	<resultMap id="signHistoryInfo" type="com.lmsltirollcallsjtu.common.bean.bo.SignHistoryInfo">
		<id column="id" property="id"/>
		<result column="section_codes" property="sectionCodes"/>
		<result column="attendances_count" property="attendancesCount"/>
		<result column="created_date" property="createdDate"/>
		<collection property="userState" ofType="com.lmsltirollcallsjtu.common.bean.bo.UserState">
			<id column="id" property="id"/>
			<result column="state" property="state"/>
		</collection>
	</resultMap>

    <!--根据点名id查询签到历史-->

    <select id="findSignHistoryByRollcallId" resultMap="signHistoryInfo">
		select h.section_codes ,
	           h.attendances_count,
	           h.created_date,
	           r.state
		from   sign_histories h,sign_records r
		where  h.id=r.rollcall_code and h.id=#{id}
	</select>
	<!--老师查询签到历史列表-->
	<!--<resultMap id="findSignHistory" type="com.lmsltirollcallsjtu.common.bean.bo.SignHistoryInfo">
		<result property="sectionIds" column="section_ids"/>
		<result property="attendancesCount" column="attendances_count"/>
		<result property="insertedAt" column="inserted_at"/>
		<collection property=""
	</resultMap>-->
	<select id="findSignHistoryListByCourseCode"
			resultType="com.lmsltirollcallsjtu.common.bean.dto.SignHistoryDto">
		select section_list sectionListJsonStr,
			   attendances_count,
			   created_date
		  from sign_histories
		 where course_code=#{courseCode}
		 order by created_date desc;
	</select>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lmsltirollcallsjtu.common.dao.UpdateStateDao">
    <!--根据字典类型从字典表中查询所有的签到状态-->
    <select id="queryRollcallStatesByDictType" parameterType="java.lang.String" resultType="com.lmsltirollcallsjtu.common.bean.dto.DictionaryDto">
            select id,
                   dict_code,
                   dict_name,
                   dict_type,
                   description
            from sign_dictionary
            where dict_type=#{dictType}
    </select>
    <!-- 老师批量更新学生的签到状态插入数据库中-->
	<update id="updateUserStateBySignRecordsDto" parameterType="java.util.List">
        <if test="userStateList!=null and userStateList.size()>0">
            <foreach collection="userStateList" item="item" separator=";">
            update sign_records
                <set>
                    <if test="updatedBy!=null and updatedBy!=''">
                        updated_by=#{item.updatedBy},
                    </if>
                    <if test="state!=null and state!=''">
                        state=#{item.state},
                    </if>
                </set>
                where user_code=#{item.userCode} and rollcall_code=#{rollcallCode}
            </foreach>
        </if>
	</update>

</mapper>